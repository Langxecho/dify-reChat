# 前端启动完整指南

## 📋 准备工作

### 1. 确认环境

```bash
# 检查Node.js版本（需要18+）
node --version

# 检查npm版本
npm --version

# 确认当前目录
pwd  # 或 cd （Windows）
# 应该在项目根目录: F:\CodeProject\dify-reChat
```

### 2. 确认后端已启动

- ✅ 后端服务运行在 http://localhost:8000
- ✅ API文档可访问: http://localhost:8000/api/docs
- ✅ 健康检查正常: http://localhost:8000/health 返回 `{"status":"healthy"}`

### 3. 确认Node.js环境

```bash
# 检查是否安装了必要的npm包
npm --version

# 检查前端目录结构
ls frontend/
```

---

## 🚀 启动步骤

### 方法1: 命令行启动（完整步骤）

#### 第一次启动

```bash
# 1. 进入前端目录
cd frontend

# 2. 安装依赖（首次运行或依赖更新后）
npm install

# 等待安装完成，会看到类似输出：
# added 234 packages, and audited 235 packages in 15s

# 3. 启动开发服务器
npm run dev
```

#### 后续启动（依赖已安装）

```bash
# 1. 进入前端目录
cd frontend

# 2. 启动开发服务器
npm run dev
```

---

### 方法2: 使用批处理脚本（Windows推荐）

```bash
# 在项目根目录双击运行
start_frontend.bat

# 或命令行运行
start_frontend.bat
```

脚本会自动：
- 检查并进入前端目录
- 安装/更新依赖（如果需要）
- 启动前端开发服务器

---

### 方法3: VSCode中启动

#### 使用集成终端

1. 在VSCode中打开项目
2. 打开终端（Ctrl + `）
3. 执行启动命令：

```bash
cd frontend
npm run dev
```

#### 使用调试配置

创建 `.vscode/launch.json`：

```json
{
    "version": "0.2.0",
    "configurations": [
        {
            "name": "Vite - 前端",
            "type": "node",
            "request": "launch",
            "command": "npm",
            "args": [
                "run",
                "dev"
            ],
            "cwd": "${workspaceFolder}/frontend",
            "console": "integratedTerminal",
            "internalConsoleOptions": "neverOpen"
        }
    ]
}
```

然后按 `F5` 启动调试。

---

### 方法4: 使用pnpm（可选，更快）

如果使用pnpm作为包管理器：

```bash
# 1. 进入前端目录
cd frontend

# 2. 安装依赖（使用pnpm）
pnpm install

# 3. 启动开发服务器
pnpm dev
```

---

## ✅ 启动成功标志

### 正常启动输出

```
VITE v5.x.x  ready in xxx ms

➜  Local:   http://localhost:5173/
➜  Network: use --host to expose
➜  press h + enter to show help
```

### 验证服务运行

**1. 访问首页**
```
浏览器访问: http://localhost:5173
应该看到Vue应用界面，可能是登录页面或主页面
```

**2. 检查网络请求**
- 打开浏览器开发者工具（F12）
- 切换到"网络"（Network）标签
- 尝试登录或查看页面
- 应该能看到发送到 `/api/*` 的请求，状态码为200

**3. 检查控制台**
- 打开浏览器开发者工具（F12）
- 查看Console标签
- 应该没有红色错误信息
- 可能会有一些正常的Vue/Vite日志

---

## 🔧 启动参数详解

### npm脚本说明

```json
{
  "scripts": {
    "dev": "vite",        // 开发服务器
    "build": "vite build", // 构建生产版本
    "preview": "vite preview" // 预览生产构建
  }
}
```

| 命令 | 说明 | 使用场景 |
|------|------|---------|
| `npm run dev` | 启动开发服务器 | 开发环境 |
| `npm run build` | 构建生产版本 | 部署前 |
| `npm run preview` | 预览生产构建 | 本地测试生产版本 |

### Vite配置详解

查看 `frontend/vite.config.ts`：

```typescript
export default defineConfig({
  plugins: [vue()],
  resolve: {
    alias: {
      '@': path.resolve(__dirname, './src')
    }
  },
  server: {
    port: 5173,              // 开发服务器端口
    proxy: {                 // API代理配置
      '/api': {
        target: 'http://localhost:8000',  // 代理目标后端
        changeOrigin: true   // 改变请求源
      }
    }
  }
})
```

#### 修改端口号

如果5173端口被占用，可以修改：

```typescript
// frontend/vite.config.ts
server: {
  port: 5174,  // 改成其他端口
  proxy: {
    '/api': {
      target: 'http://localhost:8000',
      changeOrigin: true
    }
  }
}
```

#### 修改API代理

如果后端不在8000端口：

```typescript
// frontend/vite.config.ts
server: {
  port: 5173,
  proxy: {
    '/api': {
      target: 'http://localhost:8001',  // 后端新端口
      changeOrigin: true
    }
  }
}
```

---

## ⚠️ 常见问题

### 问题1: 提示 `npm: command not found`

**原因**: Node.js或npm未安装或未添加到PATH

**解决**:
```bash
# 1. 检查Node.js是否安装
node --version
npm --version

# 2. 如果未安装，下载并安装Node.js
# 访问 https://nodejs.org/ 下载LTS版本

# 3. 检查PATH环境变量
# Windows: 在开始菜单搜索"环境变量"，编辑系统变量
# macOS/Linux: 检查 ~/.bash_profile 或 ~/.zshrc
```

---

### 问题2: npm install 失败

**错误信息**: `EACCES: permission denied` 或 `network timeout`

**解决方案1: 使用管理员权限**
```bash
# Windows PowerShell/CMD 管理员权限
cd frontend
npm install
```

**解决方案2: 清理缓存重装**
```bash
# 1. 清理npm缓存
npm cache clean --force

# 2. 删除node_modules
cd frontend
rm -rf node_modules package-lock.json

# 3. 重新安装
npm install
```

**解决方案3: 使用淘宝镜像（国内推荐）**
```bash
# 设置淘宝镜像
npm config set registry https://registry.npmmirror.com

# 重新安装
npm install
```

**解决方案4: 使用yarn或pnpm**
```bash
# 使用yarn
npm install -g yarn
cd frontend
yarn install

# 或使用pnpm
npm install -g pnpm
cd frontend
pnpm install
```

---

### 问题3: 端口被占用

**错误信息**: `Port 5173 is already in use`

**解决方案1: 换端口**
```bash
# 修改 vite.config.ts 中的 port: 5174
# 然后重启
npm run dev
```

**解决方案2: 关闭占用端口进程**

**Windows**:
```bash
# 查找占用5173端口的进程
netstat -ano | findstr :5173

# 记下PID（最后一列数字）
# 终止进程
taskkill /PID <进程ID> /F
```

**macOS/Linux**:
```bash
# 查找占用5173端口的进程
lsof -i :5173

# 终止进程
kill -9 <PID>
```

---

### 问题4: 编译错误

**错误信息**: TypeScript错误、Vue组件错误等

**解决方案**:
```bash
# 1. 清理缓存并重新安装
cd frontend
rm -rf node_modules package-lock.json
npm install

# 2. 如果还有问题，检查TypeScript版本
npm install --save-dev typescript@latest
npm install --save-dev @vue/tsconfig@latest

# 3. 检查代码语法，确保TypeScript类型正确
```

---

### 问题5: 热更新失效

**现象**: 修改代码后页面没有自动刷新

**解决**:
```bash
# 1. 重启开发服务器
npm run dev

# 2. 检查浏览器控制台是否有错误
# 3. 清理浏览器缓存（Ctrl+Shift+R）
# 4. 检查是否有语法错误导致编译失败
```

---

### 问题6: API代理不工作

**现象**: 浏览器网络面板看到CORS错误

**解决**:
```bash
# 1. 确认后端服务正在运行
curl http://localhost:8000/health

# 2. 检查 vite.config.ts 代理配置
# 确保target地址正确

# 3. 重启前端服务
npm run dev
```

---

## 🔄 开发流程

### 日常开发启动流程

```bash
# 1. 启动后端（保持运行）
cd backend
venv\Scripts\activate
uvicorn app.main:app --reload

# 2. 新终端启动前端
cd frontend
npm run dev

# 3. 修改代码
# 前端：Vue组件会热更新
# 后端：Python代码会自动重启

# 4. 测试功能
# 访问 http://localhost:5173 测试前端
# 访问 http://localhost:8000/api/docs 测试后端API
```

### 生产构建流程

```bash
# 1. 构建生产版本
cd frontend
npm run build

# 2. 预览构建结果
npm run preview

# 3. 访问预览地址（通常是http://localhost:4173）
# 测试生产版本功能
```

---

## 📊 开发监控

### 查看实时日志

```bash
# 终端输出包含：
- Vite启动信息
- 热更新事件
- 编译错误信息
- 网络请求代理信息
```

### 浏览器开发者工具

**Network面板**:
- 检查API请求是否正常代理到后端
- 查看请求状态码和响应时间
- 检查是否有CORS错误

**Console面板**:
- 查看Vue组件错误
- 检查JavaScript运行时错误
- 观察热更新信息

**Components面板** (Vue Devtools):
- 查看组件状态
- 检查组件props和events
- 调试Pinia状态

### API测试

```bash
# 测试后端API是否正常
curl http://localhost:8000/health

# 测试前端页面是否正常加载
curl -I http://localhost:5173
```

---

## 🎯 快速参考

### 完整启动命令（复制粘贴）

**首次启动**:
```bash
cd frontend && npm install && npm run dev
```

**日常启动**:
```bash
cd frontend && npm run dev
```

### 重要地址

- 前端服务: http://localhost:5173
- 后端服务: http://localhost:8000
- API文档: http://localhost:8000/api/docs
- ReDoc文档: http://localhost:8000/api/redoc

### 常用命令

```bash
# 安装依赖
npm install

# 启动开发服务器
npm run dev

# 构建生产版本
npm run build

# 预览生产构建
npm run preview

# 查看安装的包
npm list

# 查看npm版本
npm --version

# 清理缓存
npm cache clean --force
```

---

## 📚 相关文档

- [后端启动指南](./后端启动指南.md) - 后端服务启动指南
- [START_DEVELOPMENT.md](./START_DEVELOPMENT.md) - 完整开发环境指南
- [frontend/README.md](./frontend/README.md) - 前端项目详细文档
- [README.md](./README.md) - 项目总览

---

## 🎯 下一步

1. **启动前端服务**
2. **访问应用**: http://localhost:5173
3. **测试功能**:
   - 注册/登录功能
   - 聊天界面
   - 管理后台
4. **连接后端**: 确保API代理工作正常

**前端启动成功后，就可以开始开发和测试功能了！** 🚀

如有问题，请查看本文档的故障排除部分或联系技术支持。