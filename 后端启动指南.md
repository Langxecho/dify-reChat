# åç«¯å¯åŠ¨å®Œæ•´æŒ‡å—

## ğŸ“‹ å‡†å¤‡å·¥ä½œ

### 1. ç¡®è®¤ç¯å¢ƒ

```bash
# æ£€æŸ¥Pythonç‰ˆæœ¬ï¼ˆéœ€è¦3.10+ï¼‰
python --version

# æ£€æŸ¥pipæ˜¯å¦å¯ç”¨
pip --version

# ç¡®è®¤å½“å‰ç›®å½•
pwd  # æˆ– cd ï¼ˆWindowsï¼‰
# åº”è¯¥åœ¨é¡¹ç›®æ ¹ç›®å½•: F:\CodeProject\dify-reChat
```

### 2. ç¡®è®¤æ•°æ®åº“å·²é…ç½®

- æ•°æ®åº“ `dify_rechat` å·²åˆ›å»º
- `backend/.env` æ–‡ä»¶ä¸­çš„æ•°æ®åº“è¿æ¥ä¿¡æ¯æ­£ç¡®

---

## ğŸš€ å¯åŠ¨æ­¥éª¤

### æ–¹æ³•1: å‘½ä»¤è¡Œå¯åŠ¨ï¼ˆå®Œæ•´æ­¥éª¤ï¼‰

#### ç¬¬ä¸€æ¬¡å¯åŠ¨

```bash
# 1. è¿›å…¥åç«¯ç›®å½•
cd backend

# 2. åˆ›å»ºPythonè™šæ‹Ÿç¯å¢ƒ
python -m venv venv

# 3. æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
# Windows PowerShell/CMD:
venv\Scripts\activate

# macOS/Linux:
# source venv/bin/activate

# æ¿€æ´»æˆåŠŸåï¼Œå‘½ä»¤è¡Œå‰ä¼šæ˜¾ç¤º (venv) æ ‡è¯†

# 4. å‡çº§pipï¼ˆå¯é€‰ä½†æ¨èï¼‰
python -m pip install --upgrade pip

# 5. å®‰è£…æ‰€æœ‰ä¾èµ–
pip install -r requirements.txt

# 6. æµ‹è¯•æ•°æ®åº“è¿æ¥
python test_connection.py

# å¦‚æœçœ‹åˆ° âœ… è¿æ¥æˆåŠŸï¼Œè¯´æ˜é…ç½®æ­£ç¡®

# 7. å¯åŠ¨åç«¯æœåŠ¡
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

#### åç»­å¯åŠ¨ï¼ˆè™šæ‹Ÿç¯å¢ƒå·²åˆ›å»ºï¼‰

```bash
# 1. è¿›å…¥åç«¯ç›®å½•
cd backend

# 2. æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
venv\Scripts\activate

# 3. å¯åŠ¨æœåŠ¡
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

---

### æ–¹æ³•2: ä½¿ç”¨æ‰¹å¤„ç†è„šæœ¬ï¼ˆWindowsæ¨èï¼‰

```bash
# åŒå‡»è¿è¡Œ
start_backend.bat

# æˆ–å‘½ä»¤è¡Œè¿è¡Œ
start_backend.bat
```

è„šæœ¬ä¼šè‡ªåŠ¨ï¼š
- æ£€æŸ¥å¹¶åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
- æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
- å®‰è£…/æ›´æ–°ä¾èµ–
- å¯åŠ¨åç«¯æœåŠ¡

---

### æ–¹æ³•3: VSCodeä¸­å¯åŠ¨

#### ä½¿ç”¨é›†æˆç»ˆç«¯

1. åœ¨VSCodeä¸­æ‰“å¼€é¡¹ç›®
2. æ‰“å¼€ç»ˆç«¯ï¼ˆCtrl + `ï¼‰
3. æ‰§è¡Œå¯åŠ¨å‘½ä»¤ï¼š

```bash
cd backend
venv\Scripts\activate
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

#### ä½¿ç”¨è°ƒè¯•é…ç½®

åˆ›å»º `.vscode/launch.json`ï¼š

```json
{
    "version": "0.2.0",
    "configurations": [
        {
            "name": "FastAPI - åç«¯",
            "type": "python",
            "request": "launch",
            "module": "uvicorn",
            "args": [
                "app.main:app",
                "--reload",
                "--host",
                "0.0.0.0",
                "--port",
                "8000"
            ],
            "cwd": "${workspaceFolder}/backend",
            "env": {
                "PYTHONPATH": "${workspaceFolder}/backend"
            },
            "console": "integratedTerminal"
        }
    ]
}
```

ç„¶åæŒ‰ `F5` å¯åŠ¨è°ƒè¯•ã€‚

---

## âœ… å¯åŠ¨æˆåŠŸæ ‡å¿—

### æ­£å¸¸å¯åŠ¨è¾“å‡º

```
INFO:     Will watch for changes in these directories: ['F:\\CodeProject\\dify-reChat\\backend']
INFO:     Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
INFO:     Started reloader process [xxxxx] using WatchFiles
INFO:     Started server process [xxxxx]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
```

### éªŒè¯æœåŠ¡è¿è¡Œ

**1. å¥åº·æ£€æŸ¥**
```bash
# æµè§ˆå™¨è®¿é—®æˆ–ä½¿ç”¨curl
curl http://localhost:8000/health

# åº”è¯¥è¿”å›
{"status":"healthy"}
```

**2. APIæ–‡æ¡£**
```
æµè§ˆå™¨è®¿é—®: http://localhost:8000/api/docs
åº”è¯¥èƒ½çœ‹åˆ°Swagger UIç•Œé¢ï¼Œæ˜¾ç¤ºæ‰€æœ‰APIç«¯ç‚¹
```

**3. æ ¹è·¯å¾„**
```
æµè§ˆå™¨è®¿é—®: http://localhost:8000/
åº”è¯¥è¿”å›é¡¹ç›®ä¿¡æ¯JSON
```

---

## ğŸ”§ å¯åŠ¨å‚æ•°è¯¦è§£

### åŸºæœ¬å‚æ•°

```bash
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

| å‚æ•° | è¯´æ˜ | é»˜è®¤å€¼ | å¼€å‘å»ºè®® |
|------|------|--------|---------|
| `app.main:app` | FastAPIåº”ç”¨è·¯å¾„ | - | å¿…å¡« |
| `--reload` | ä»£ç ä¿®æ”¹è‡ªåŠ¨é‡å¯ | False | å¼€å‘ç¯å¢ƒå¼€å¯ |
| `--host` | ç›‘å¬åœ°å€ | 127.0.0.1 | 0.0.0.0å…è®¸å¤–éƒ¨è®¿é—® |
| `--port` | ç«¯å£å· | 8000 | æŒ‰éœ€ä¿®æ”¹ |

### å…¶ä»–æœ‰ç”¨å‚æ•°

```bash
# æŒ‡å®šä¸åŒç«¯å£
uvicorn app.main:app --reload --port 8001

# ä»…æœ¬åœ°è®¿é—®
uvicorn app.main:app --reload --host 127.0.0.1 --port 8000

# è®¾ç½®æ—¥å¿—çº§åˆ«
uvicorn app.main:app --reload --log-level debug

# è®¾ç½®å·¥ä½œè¿›ç¨‹æ•°ï¼ˆç”Ÿäº§ç¯å¢ƒï¼Œä¸è¦å’Œ--reloadä¸€èµ·ç”¨ï¼‰
uvicorn app.main:app --workers 4 --host 0.0.0.0 --port 8000
```

---

## âš ï¸ å¸¸è§é—®é¢˜

### é—®é¢˜1: æç¤º `uvicorn: command not found`

**åŸå› **: uvicornæœªå®‰è£…æˆ–è™šæ‹Ÿç¯å¢ƒæœªæ¿€æ´»

**è§£å†³**:
```bash
# ç¡®ä¿è™šæ‹Ÿç¯å¢ƒå·²æ¿€æ´»ï¼ˆæç¤ºç¬¦å‰æœ‰(venv)ï¼‰
venv\Scripts\activate

# é‡æ–°å®‰è£…uvicorn
pip install uvicorn[standard]

# æˆ–é‡æ–°å®‰è£…æ‰€æœ‰ä¾èµ–
pip install -r requirements.txt
```

---

### é—®é¢˜2: æ•°æ®åº“è¿æ¥å¤±è´¥

**é”™è¯¯ä¿¡æ¯**: `Can't connect to MySQL server` æˆ– `Access denied`

**è§£å†³æ­¥éª¤**:

```bash
# 1. æµ‹è¯•æ•°æ®åº“è¿æ¥
python test_connection.py

# 2. æ£€æŸ¥.envé…ç½®
type .env  # Windows
# cat .env  # macOS/Linux

# 3. æ‰‹åŠ¨æµ‹è¯•MySQLè¿æ¥
mysql -h 43.143.8.251 -P 3306 -u shy -p
# è¾“å…¥å¯†ç : 20040614aaa@shy

# 4. ç¡®è®¤æ•°æ®åº“å­˜åœ¨
mysql -h 43.143.8.251 -P 3306 -u shy -p
USE dify_rechat;
SHOW TABLES;
```

---

### é—®é¢˜3: ç«¯å£è¢«å ç”¨

**é”™è¯¯ä¿¡æ¯**: `Address already in use` æˆ– `OSError: [Errno 48]`

**è§£å†³æ–¹æ¡ˆ1: æ¢ç«¯å£**
```bash
uvicorn app.main:app --reload --port 8001
```

**è§£å†³æ–¹æ¡ˆ2: å…³é—­å ç”¨ç«¯å£çš„è¿›ç¨‹ï¼ˆWindowsï¼‰**
```bash
# æŸ¥æ‰¾å ç”¨8000ç«¯å£çš„è¿›ç¨‹
netstat -ano | findstr :8000

# è®°ä¸‹PIDï¼ˆæœ€åä¸€åˆ—æ•°å­—ï¼‰
# ç»ˆæ­¢è¿›ç¨‹
taskkill /PID <è¿›ç¨‹ID> /F
```

**è§£å†³æ–¹æ¡ˆ3: å…³é—­å ç”¨ç«¯å£çš„è¿›ç¨‹ï¼ˆmacOS/Linuxï¼‰**
```bash
# æŸ¥æ‰¾å ç”¨8000ç«¯å£çš„è¿›ç¨‹
lsof -i :8000

# ç»ˆæ­¢è¿›ç¨‹
kill -9 <PID>
```

---

### é—®é¢˜4: å¯¼å…¥é”™è¯¯

**é”™è¯¯ä¿¡æ¯**: `ModuleNotFoundError: No module named 'xxx'`

**è§£å†³**:
```bash
# ç¡®ä¿åœ¨backendç›®å½•
cd backend

# ç¡®ä¿è™šæ‹Ÿç¯å¢ƒå·²æ¿€æ´»
venv\Scripts\activate

# é‡æ–°å®‰è£…ä¾èµ–
pip install -r requirements.txt

# å¦‚æœè¿˜æœ‰é—®é¢˜ï¼Œåˆ é™¤è™šæ‹Ÿç¯å¢ƒé‡å»º
deactivate
rmdir /s venv  # Windows
# rm -rf venv  # macOS/Linux
python -m venv venv
venv\Scripts\activate
pip install -r requirements.txt
```

---

### é—®é¢˜5: SQLAlchemyé”™è¯¯

**é”™è¯¯ä¿¡æ¯**: `Attribute name 'metadata' is reserved`

**åŸå› **: è¿™ä¸ªé—®é¢˜å·²ç»ä¿®å¤ï¼Œ`metadata` å­—æ®µå·²æ”¹ä¸º `meta_data`

**è§£å†³**: ç¡®ä¿ä½¿ç”¨æœ€æ–°çš„ä»£ç ï¼Œå¦‚æœè¿˜æœ‰é—®é¢˜ï¼š

```bash
# é‡æ–°æ‹‰å–æœ€æ–°ä»£ç æˆ–æ£€æŸ¥æ–‡ä»¶
# backend/app/models/message.py ä¸­åº”è¯¥æ˜¯ meta_data è€Œä¸æ˜¯ metadata
```

---

### é—®é¢˜6: Pythonè™šæ‹Ÿç¯å¢ƒæ¿€æ´»å¤±è´¥ï¼ˆWindows PowerShellï¼‰

**é”™è¯¯ä¿¡æ¯**: `æ— æ³•åŠ è½½æ–‡ä»¶ï¼Œå› ä¸ºåœ¨æ­¤ç³»ç»Ÿä¸Šç¦æ­¢è¿è¡Œè„šæœ¬`

**è§£å†³**:
```powershell
# ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡ŒPowerShell
Set-ExecutionPolicy RemoteSigned -Scope CurrentUser

# ç„¶åé‡æ–°æ¿€æ´»
venv\Scripts\activate
```

**æˆ–ä½¿ç”¨CMDä»£æ›¿PowerShell**:
```bash
# åœ¨å¼€å§‹èœå•æœç´¢ cmd
# è¿›å…¥é¡¹ç›®ç›®å½•å
cd backend
venv\Scripts\activate
```

---

## ğŸ”„ å¼€å‘æµç¨‹

### æ—¥å¸¸å¼€å‘å¯åŠ¨æµç¨‹

```bash
# 1. å¯åŠ¨åç«¯ï¼ˆä¿æŒè¿è¡Œï¼‰
cd backend
venv\Scripts\activate
uvicorn app.main:app --reload

# 2. ä¿®æ”¹ä»£ç 
# ä»£ç ä¿å­˜åä¼šè‡ªåŠ¨é‡å¯ï¼Œæ— éœ€æ‰‹åŠ¨é‡å¯

# 3. æµ‹è¯•API
# è®¿é—® http://localhost:8000/api/docs

# 4. åœæ­¢æœåŠ¡
# æŒ‰ Ctrl+C
```

### ä¿®æ”¹æ¨¡å‹åçš„æµç¨‹

å¦‚æœä¿®æ”¹äº†æ•°æ®åº“æ¨¡å‹ï¼ˆ`app/models/`ï¼‰ï¼š

```bash
# 1. åœæ­¢æœåŠ¡ï¼ˆCtrl+Cï¼‰

# 2. åˆ›å»ºè¿ç§»
alembic revision --autogenerate -m "æè¿°ä¿®æ”¹å†…å®¹"

# 3. æ‰§è¡Œè¿ç§»
alembic upgrade head

# 4. é‡æ–°å¯åŠ¨
uvicorn app.main:app --reload
```

---

## ğŸ“Š å¼€å‘ç›‘æ§

### æŸ¥çœ‹æ—¥å¿—

åç«¯æ—¥å¿—ä¼šç›´æ¥è¾“å‡ºåˆ°ç»ˆç«¯ï¼ŒåŒ…æ‹¬ï¼š
- è¯·æ±‚æ—¥å¿—
- é”™è¯¯ä¿¡æ¯
- æ•°æ®åº“æŸ¥è¯¢ï¼ˆDEBUGæ¨¡å¼ä¸‹ï¼‰

### å®æ—¶ç›‘æ§

```bash
# å¯åŠ¨æ—¶ä¼šæ˜¾ç¤º
INFO: Will watch for changes in these directories: ['...']

# ä»£ç ä¿®æ”¹åä¼šçœ‹åˆ°
INFO: Detected changes in 'xxx.py'. Reloading...
INFO: Started reloader process [xxxxx]
```

### APIæµ‹è¯•

```bash
# ä½¿ç”¨Swagger UIï¼ˆæ¨èï¼‰
http://localhost:8000/api/docs

# ä½¿ç”¨curl
curl -X GET http://localhost:8000/health
curl -X GET http://localhost:8000/api/docs

# ä½¿ç”¨Postmanæˆ–å…¶ä»–APIæµ‹è¯•å·¥å…·
# å¯¼å…¥ http://localhost:8000/api/openapi.json
```

---

## ğŸ¯ å¿«é€Ÿå‚è€ƒ

### å®Œæ•´å¯åŠ¨å‘½ä»¤ï¼ˆå¤åˆ¶ç²˜è´´ï¼‰

**é¦–æ¬¡å¯åŠ¨**:
```bash
cd backend && python -m venv venv && venv\Scripts\activate && pip install -r requirements.txt && python test_connection.py && uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

**æ—¥å¸¸å¯åŠ¨**:
```bash
cd backend && venv\Scripts\activate && uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

### é‡è¦åœ°å€

- åç«¯æœåŠ¡: http://localhost:8000
- APIæ–‡æ¡£: http://localhost:8000/api/docs
- ReDocæ–‡æ¡£: http://localhost:8000/api/redoc
- å¥åº·æ£€æŸ¥: http://localhost:8000/health

### å¸¸ç”¨å‘½ä»¤

```bash
# æµ‹è¯•æ•°æ®åº“è¿æ¥
python test_connection.py

# æŸ¥çœ‹å®‰è£…çš„åŒ…
pip list

# ç”Ÿæˆrequirements.txt
pip freeze > requirements.txt

# æŸ¥çœ‹Uvicornç‰ˆæœ¬
uvicorn --version

# æŸ¥çœ‹FastAPIç‰ˆæœ¬
pip show fastapi
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [START_DEVELOPMENT.md](START_DEVELOPMENT.md) - å®Œæ•´å¼€å‘ç¯å¢ƒæŒ‡å—
- [å¼€å§‹ä½¿ç”¨-è¿œç¨‹æ•°æ®åº“.txt](å¼€å§‹ä½¿ç”¨-è¿œç¨‹æ•°æ®åº“.txt) - è¿œç¨‹æ•°æ®åº“é…ç½®
- [README.md](README.md) - é¡¹ç›®æ€»è§ˆ
- [backend/README.md](backend/README.md) - åç«¯è¯¦ç»†æ–‡æ¡£

---

**å¯åŠ¨æˆåŠŸåï¼Œåˆ«å¿˜äº†å¯åŠ¨å‰ç«¯ï¼** ğŸš€

æŸ¥çœ‹å‰ç«¯å¯åŠ¨æŒ‡å—ï¼šåŒå‡»è¿è¡Œ `start_frontend.bat` æˆ–æŸ¥çœ‹æ–‡æ¡£ã€‚
